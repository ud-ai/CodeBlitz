(()=>{chrome.runtime.onInstalled.addListener(()=>{console.log("CodeBlitz Extension Installed")});chrome.runtime.onMessage.addListener((o,c,s)=>{if(o.type==="AI_QUERY"){let a=o.prompt||o.message,i=o.problemStatement||"";return(async()=>{try{let e=new AbortController,n=setTimeout(()=>e.abort(),25e3);try{let t=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent",{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":"AIzaSyDXj0nlNs5Z6S0OpEBSWdGh29hw9IrBUOo"},body:JSON.stringify({contents:[{role:"user",parts:[{text:i?`Problem: ${i}

User query: ${a}`:a}]}],systemInstruction:{role:"system",parts:[{text:"You are an expert LeetCode interview assistant. Help users solve coding problems with questions and guidance."}]},generationConfig:{temperature:.7,maxOutputTokens:1e3}}),signal:e.signal});if(clearTimeout(n),!t.ok)throw new Error(`API responded with status: ${t.status}`);let r=await t.json();return console.log("Gemini response data:",r),r?.candidates&&r.candidates.length>0&&r.candidates[0].content?.parts&&r.candidates[0].content.parts.length>0?{answer:r.candidates[0].content.parts[0].text.trim()}:r?.error?(console.error("Gemini API Error:",r.error),{answer:"Gemini API error: "+r.error.message}):{answer:"No valid response received from AI."}}catch(t){throw t instanceof Error&&t.name==="AbortError"?new Error("Request timed out. Please try again."):t}finally{clearTimeout(n)}}catch(e){return console.error("Fetch error:",e),{error:e instanceof Error?e.message:String(e),answer:"Network or Gemini error: "+(e instanceof Error?e.message:String(e))}}})().then(e=>{try{s(e)}catch(n){console.error("Error sending response:",n)}}).catch(e=>{console.error("Unexpected error in fetchData:",e);try{s({answer:"Unexpected error: "+(e instanceof Error?e.message:String(e))})}catch(n){console.error("Error sending error response:",n)}}),!0}});})();
